{"version":3,"sources":["admin.js"],"names":["$","REGIONS","CHARACTERS","id","name","image","charas","i","len","length","chara","database","firebase","ref","teamsRef","child","singlesRef","configRef","config","once","snapshot","val","open","adminPass","set","configUpdated","on","show","removeClass","addClass","text","hide","e","preventDefault","teams","team","key","push","teamUpdated","singles","single","singleUpdated","splice","old","updatedAt","getDateString","analytics","date","undefined","Date","getFullYear","padLeft","getMonth","getDate","getHours","getMinutes","getSeconds","str","pad","buf","slice","task","clearTimeout","setTimeout","totalCount","afterCount","forEach","members","member","after","objectToArray","object","array","BOM","prop","encodeURIComponent","createTeamsData","EscapeSJIS","createSinglesData","rowHeader","rows","columns","character","comment","parseInt","region","filterDefaultStr","env","history","lines","join","md5"],"mappings":"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","file":"admin.js","sourcesContent":["$(function(){\n\n  var REGIONS = ['北海道','青森県','岩手県','宮城県','秋田県',\n  '山形県','福島県','茨城県','栃木県','群馬県','埼玉県','千葉県',\n  '東京都','神奈川県','新潟県','富山県','石川県','福井県','山梨県',\n  '長野県','岐阜県','静岡県','愛知県','三重県','滋賀県','京都府',\n  '大阪府','兵庫県','奈良県','和歌山県','鳥取県','島根県','岡山県',\n  '広島県','山口県','徳島県','香川県','愛媛県','高知県','福岡県',\n  '佐賀県','長崎県','熊本県','大分県','宮崎県','鹿児島県','沖縄県'\n  ];\n\n  var CHARACTERS = [\n    {\n      id: 'anakaris',\n      name: 'アナカリス',\n      image: 'img_s_anakaris_50x50.jpg'\n    }, {\n      id: 'aulbath',\n      name: 'オルバス',\n      image: 'img_s_aulbath_50x50.jpg'\n    }, {\n      id: 'bishamon',\n      name: 'ビシャモン',\n      image: 'img_s_bishamon_50x50.jpg'\n    }, {\n      id: 'bulleta',\n      name: 'バレッタ',\n      image: 'img_s_bulleta_50x50.jpg'\n    }, {\n      id: 'demitri',\n      name: 'デミトリ',\n      image: 'img_s_demitri_50x50.jpg'\n    }, {\n      id: 'felicia',\n      name: 'フェリシア',\n      image: 'img_s_felicia_50x50.jpg'\n    }, {\n      id: 'gallon',\n      name: 'ガロン',\n      image: 'img_s_gallon_50x50.jpg'\n    }, {\n      id: 'jedah',\n      name: 'ジェダ',\n      image: 'img_s_jedah_50x50.jpg'\n    }, {\n      id: 'leilei',\n      name: 'レイレイ',\n      image: 'img_s_leilei_50x50.jpg'\n    }, {\n      id: 'lilith',\n      name: 'リリス',\n      image: 'img_s_lilith_50x50.jpg'\n    }, {\n      id: 'morrigan',\n      name: 'モリガン',\n      image: 'img_s_morrigan_50x50.jpg'\n    }, {\n      id: 'qbee',\n      name: 'キュービー',\n      image: 'img_s_qbee_50x50.jpg'\n    }, {\n      id: 'sasquatch',\n      name: 'サスカッチ',\n      image: 'img_s_sasquatch_50x50.jpg'\n    }, {\n      id: 'victor',\n      name: 'ビクトル',\n      image: 'img_s_victor_50x50.jpg'\n    }, {\n      id: 'zabel',\n      name: 'ザベル',\n      image: 'img_s_zabel_50x50.jpg'\n    }\n  ];\n\n  // ハッシュ作成\n  var charas = {}\n  for (var i = 0, len = CHARACTERS.length; i < len; i++) {\n    var chara = CHARACTERS[i];\n    charas[chara.id] = {\n      name: chara.name,\n      image: chara.image\n    };\n  }\n\n  // firebase\n  var database = firebase.database();\n  var ref = database.ref('06/data');\n  var teamsRef = ref.child('teams');\n  var singlesRef = ref.child('singles');\n\n  // 設定\n  var configRef = ref.child('config');\n  var config;\n  configRef.child('open');\n  configRef.once('value', function(snapshot) {\n    config = snapshot.val();\n    if (!config) {\n      config = {\n        open: true,\n        adminPass: 'e421b0ade1927b91fa41bfa2baf72eb5'\n      }\n      configRef.set(config);\n    }\n    configUpdated(config);\n    configRef.on('value', function(snapshot) {\n      config = snapshot.val();\n      configUpdated(config);\n    });\n  });\n\n  function configUpdated(config) {\n    $('.status').show();\n    if (config.open) {\n      $('.status').removeClass('alert-warning').addClass('alert-success');\n      $('.status-text').text('只今エントリー受付中');\n      $('.start').hide();\n      $('.stop').show();\n    } else {\n      $('.status').removeClass('alert-success').addClass('alert-warning');\n      $('.status-text').text('エントリー受付停止中');\n      $('.start').show();\n      $('.stop').hide();\n    }\n  }\n\n  $('.start').on('click', function(e) {\n    e.preventDefault();\n    config.open = true;\n    configRef.set(config);\n  });\n  $('.stop').on('click', function(e) {\n    e.preventDefault();\n    config.open = false;\n    configRef.set(config);\n  });\n\n\n\n  // 追加\n  var teams = [];\n  teamsRef.on('child_added', function(snapshot) {\n    var team = snapshot.val();\n    var key = snapshot.key;\n    team.key = key;\n    teams.push(team);\n    teamUpdated(team);\n  });\n  var singles = [];\n  singlesRef.on('child_added', function(snapshot) {\n    var single = snapshot.val();\n    var key = snapshot.key;\n    single.key = key;\n    singles.push(single);\n    singleUpdated(single);\n  });\n\n  // 削除\n  teamsRef.on('child_removed', function(snapshot) {\n    var key = snapshot.key;\n    for (var i = 0, len = teams.length; i < len; i++) {\n      if (teams[i].key === key) {\n        teams.splice(i, 1);\n        break;\n      }\n    }\n    teamUpdated();\n  });\n  singlesRef.on('child_removed', function(snapshot) {\n    var key = snapshot.key;\n    for (var i = 0, len = singles.length; i < len; i++) {\n      if (singles[i].key === key) {\n        singles.splice(i, 1);\n        break;\n      }\n    }\n    singleUpdated();\n  });\n\n  // 変更\n  teamsRef.on('child_changed', function(snapshot, old) {\n    var team = snapshot.val();\n    var key = snapshot.key;\n    team.key = key;\n    for (var i = 0, len = teams.length; i < len; i++) {\n      if (teams[i].key === key) {\n        teams[i] = team;\n        break;\n      }\n    }\n    teamUpdated(team);\n  });\n  singlesRef.on('child_changed', function(snapshot, old) {\n    var single = snapshot.val();\n    var key = snapshot.key;\n    single.key = key;\n    for (var i = 0, len = singles.length; i < len; i++) {\n      if (singles[i].key === key) {\n        singles[i] = single;\n        break;\n      }\n    }\n    singleUpdated(single);\n  });\n\n  function teamUpdated(team) {\n    $('.team-entry-count').text(teams.length);\n    if (team) {\n      if (team.updatedAt) {\n        $('.team-last-updated-at').text(getDateString(team.updatedAt));\n      }\n    } else {\n      $('.team-last-updated-at').text(getDateString());\n    }\n    analytics();\n  }\n  function singleUpdated(single) {\n    $('.single-entry-count').text(singles.length);\n    if (single) {\n      if (single.updatedAt) {\n        $('.single-last-updated-at').text(getDateString(single.updatedAt));\n      }\n    } else {\n      $('.single-last-updated-at').text(getDateString());\n    }\n    analytics();\n  }\n\n  function getDateString(date) {\n    if (date === undefined) {\n      date = new Date();\n    } else if (typeof date === 'string' && date.length !== 0) {\n      date = new Date(date);\n    }\n    if (date) {\n      return date.getFullYear() + '/' +\n             padLeft(date.getMonth() + 1) + '/' +\n             padLeft(date.getDate()) + ' ' +\n             padLeft(date.getHours()) + ':' +\n             padLeft(date.getMinutes()) + ':' +\n             padLeft(date.getSeconds());\n    } else {\n      return '';\n    }\n  }\n  function padLeft(str, len, pad) {\n    if (pad === undefined) {\n      pad = '0';\n    }\n    if (len === undefined) {\n      len = 2;\n    }\n    var buf = ''\n    for (var i = 0; i < len; i++) {\n      buf += pad;\n    }\n    str = pad + str;\n    return str.slice(-len);\n  }\n\n  var task;\n  function analytics() {\n    if (task) {\n      clearTimeout(task);\n    }\n    task = setTimeout(function() {\n\n      // 総参加者カウント\n      let totalCount = 0;\n      var afterCount = 0;\n      teams.forEach(team => {\n        team.members.forEach(member => {\n          if (member.name) {\n            totalCount++;\n            if (member.after == 1) {\n              afterCount++;\n            }\n          }\n        });\n      });\n      singles.forEach(team => {\n        team.members.forEach(member => {\n          if (member.name) {\n            totalCount++;\n            if (member.after == 1) {\n              afterCount++;\n            }\n          }\n        });\n      });\n      $('.total-count').text(totalCount);\n      $('.after-count').text(afterCount);\n\n    }, 1000);\n  }\n  function objectToArray(object) {\n    var array = [];\n    for (var key in object) {\n      array.push(object[key]);\n    }\n    return array;\n  }\n\n  var BOM = '\\ufeff';\n  $('#teams-output-utf8').on('click', function(e) {\n    $(this).prop('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(BOM + createTeamsData()));\n  });\n  $('#teams-output-sjis').on('click', function(e) {\n    $(this).prop('href', 'data:text/plain;charset=sjis,' + EscapeSJIS(createTeamsData()));\n  });\n  $('#singles-output-utf8').on('click', function(e) {\n    $(this).prop('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(BOM + createSinglesData()));\n  });\n  $('#singles-output-sjis').on('click', function(e) {\n    $(this).prop('href', 'data:text/plain;charset=sjis,' + EscapeSJIS(createSinglesData()));\n  });\n\n  function createTeamsData() {\n    var rowHeader = [\n      'チーム名',\n      '1:プレイヤー名',\n      '1:使用キャラ',\n      '1:コメント',\n      '1:主な活動地域',\n      '1:主なプレイ環境',\n      '1:セイヴァー歴',\n      '1:打ち上げ',\n      '2:プレイヤー名',\n      '2:使用キャラ',\n      '2:コメント',\n      '2:主な活動地域',\n      '2:主なプレイ環境',\n      '2:セイヴァー歴',\n      '2:打ち上げ',\n      '3:プレイヤー名',\n      '3:使用キャラ',\n      '3:コメント',\n      '3:主な活動地域',\n      '3:主なプレイ環境',\n      '3:セイヴァー歴',\n      '3:打ち上げ',\n      '更新日時'\n    ];\n    var rows = [];\n    rows.push(rowHeader);\n    for (var i = 0, len = teams.length; i < len; i++) {\n      var team = teams[i];\n      var columns = [];\n      columns.push(team.name || '');\n      team.members.forEach(member => {\n        columns.push(member.name || '');\n        let chara = charas[member.character];\n        if (!chara) {\n          chara = {\n            name: ''\n          };\n        }\n        columns.push(chara.name);\n        columns.push(member.comment || '');\n        columns.push(REGIONS[parseInt(member.region, 10) - 1] || '');\n        columns.push(filterDefaultStr(member.env) || '');\n        columns.push(filterDefaultStr(member.history) || '');\n        columns.push(member.after || '');\n      });\n      columns.push(getDateString(team.updatedAt));\n      rows.push(columns);\n    }\n\n    // parse\n    var lines = [];\n    for (var i = 0, len = rows.length; i < len; i++) {\n      lines.push('\"' + rows[i].join('\",\"') + '\"');\n    }\n    return lines.join('\\n');\n  }\n  function createSinglesData() {\n    var rowHeader = [\n      'プレイヤー名',\n      '使用キャラ',\n      'コメント',\n      '主な活動地域',\n      '主なプレイ環境',\n      'セイヴァー歴',\n      '打ち上げ'\n    ];\n    var rows = [];\n    rows.push(rowHeader);\n    for (var i = 0, len = singles.length; i < len; i++) {\n      var single = singles[i];\n      var columns = [];\n      single.members.forEach(member => {\n        columns.push(member.name || '');\n        let chara = charas[member.character];\n        if (!chara) {\n          chara = {\n            name: ''\n          };\n        }\n        columns.push(chara.name);\n        columns.push(member.comment || '');\n        columns.push(REGIONS[parseInt(member.region, 10) - 1] || '');\n        columns.push(filterDefaultStr(member.env) || '');\n        columns.push(filterDefaultStr(member.history) || '');\n        columns.push(member.after || '');\n      });\n      columns.push(getDateString(single.updatedAt));\n      rows.push(columns);\n    }\n\n    // parse\n    var lines = [];\n    for (var i = 0, len = rows.length; i < len; i++) {\n      lines.push('\"' + rows[i].join('\",\"') + '\"');\n    }\n    return lines.join('\\n');\n  }\n  function filterDefaultStr(str) {\n    if ('選択してください' === str) {\n      return '';\n    } else {\n      return str;\n    }\n  }\n\n  // login\n  $('#login-button').on('click', function(e) {\n    e.preventDefault();\n    if ( config.adminPass === md5($('#admin-pass').val())) {\n      $('.login').hide();\n      $('.page').show();\n    } else {\n      $('.login-message').addClass('alert-danger').text('パスワードが違います').show();\n    }\n  });\n\n  analytics();\n});"]}